syntax = "proto3";

package api.v1;

option go_package = "github.com/brendanjerwin/simple_wiki/gen/go/api/v1;apiv1";

// The Search service definition.
service SearchService {
  // Searches the wiki content and returns matching results.
  rpc SearchContent(SearchContentRequest) returns (SearchContentResponse) {}
}

// The request message for searching content.
message SearchContentRequest {
  string query = 1;
  // Optional: filter results to only pages that have ALL of these frontmatter keys
  repeated string frontmatter_key_include_filters = 2;
  // Optional: filter OUT results that have ANY of these frontmatter keys
  repeated string frontmatter_key_exclude_filters = 3;
  // Optional: frontmatter dot-paths whose values should be returned in each result
  repeated string frontmatter_keys_to_return_in_results = 4;
}

// The response message containing search results.
message SearchContentResponse {
  repeated SearchResult results = 1;
  // Total count of results without filtering (for inventory filter warning)
  int32 total_unfiltered_count = 2;
}

// A search result item.
message SearchResult {
  string identifier = 1; // Page identifier
  string title = 2; // Page title
  string fragment = 3; // Plain text fragment (no HTML)
  repeated HighlightSpan highlights = 4; // Highlight positions
  map<string, string> frontmatter = 5; // Requested frontmatter values (dot-path -> value)
  InventoryContext inventory_context = 6; // Inventory context (if result is an inventory item)
}

// Inventory context for search results.
message InventoryContext {
  bool is_inventory_related = 1; // Whether this result is inventory-related
  repeated ContainerPathElement path = 2; // Full path from root to immediate container
}

// A single element in a container path.
message ContainerPathElement {
  string identifier = 1; // Container identifier
  string title = 2; // Container title (if available, otherwise will be empty)
  int32 depth = 3; // Depth level in hierarchy (0 = root, higher = deeper)
}

// A span of text to be highlighted.
message HighlightSpan {
  int32 start = 1; // Start position in fragment
  int32 end = 2; // End position in fragment
}
